# éŸ³é¢‘è´¨é‡æ£€æŸ¥è„šæœ¬ä½¿ç”¨æŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨åŸºäº Whisper ASR çš„éŸ³é¢‘è´¨é‡æ£€æŸ¥è„šæœ¬æ¥æ£€æµ‹å’Œä¿®å¤éŸ³é¢‘é—®é¢˜ã€‚

## è„šæœ¬æ¦‚è¿°

æˆ‘ä»¬æœ‰ä¸¤ä¸ªéŸ³é¢‘è´¨é‡æ£€æŸ¥è„šæœ¬ï¼š

### 1. `check_audio_quality_with_whisper.py` - å®Œæ•´æ£€æŸ¥è„šæœ¬
**åŠŸèƒ½**: å…¨é¢æ£€æŸ¥æŒ‡å®šæ¨¡å—çš„æ‰€æœ‰éŸ³é¢‘æ–‡ä»¶ï¼Œç”Ÿæˆè¯¦ç»†æŠ¥å‘Š

**ç‰¹ç‚¹**:
- æ£€æŸ¥ wordsã€phrasesã€patternsã€quests æ‰€æœ‰éŸ³é¢‘
- æ”¯æŒè‡ªå®šä¹‰æ¨¡å—é€‰æ‹©
- ç”Ÿæˆè¯¦ç»†çš„æ–‡æœ¬æ ¼å¼æŠ¥å‘Š
- è¯†åˆ«æ–‡ä»¶ç¼ºå¤±ã€è½¬å½•å¤±è´¥ç­‰é—®é¢˜
- **æ”¯æŒæ‰€æœ‰å¹´çº§æ¨¡å—**ï¼ŒåŒ…æ‹¬ Grade 6 ä¸Šå­¦æœŸå’Œä¸‹å­¦æœŸ

### 2. `quick_audio_check.py` - å¿«é€Ÿæ£€æŸ¥è„šæœ¬
**åŠŸèƒ½**: å¿«é€Ÿæ£€æŸ¥ç‰¹å®šæ¨¡å—çš„å…³é”®éŸ³é¢‘æ–‡ä»¶

**ç‰¹ç‚¹**:
- è½»é‡çº§ï¼Œæ£€æŸ¥é€Ÿåº¦å¿«
- ä¸“æ³¨äºé—®é¢˜æ¨¡å—çš„å…³é”®æ–‡ä»¶
- ç®€æ´çš„æ§åˆ¶å°è¾“å‡º
- é€‚åˆæ—¥å¸¸å¿«é€Ÿæ£€æŸ¥
- **æ”¯æŒé‡ç‚¹æ¨¡å—çš„å¿«é€Ÿæ£€æŸ¥**

## ä½¿ç”¨æ–¹æ³•

### å®Œæ•´æ£€æŸ¥è„šæœ¬

```bash
# æ£€æŸ¥æ‰€æœ‰æ¨¡å—
python3 scripts/check_audio_quality_with_whisper.py --all

# æ£€æŸ¥æŒ‡å®šæ¨¡å— (Grade 6 ä¸Šå­¦æœŸ)
python3 scripts/check_audio_quality_with_whisper.py --modules stamps-hobbies festivals habits-tidy

# æ£€æŸ¥æŒ‡å®šæ¨¡å— (Grade 6 ä¸‹å­¦æœŸ)
python3 scripts/check_audio_quality_with_whisper.py --modules ordering-food past-events plans-and-weather

# æ£€æŸ¥å•ä¸ªæ¨¡å—
python3 scripts/check_audio_quality_with_whisper.py --modules stamps-hobbies
```

### å¿«é€Ÿæ£€æŸ¥è„šæœ¬

```bash
# æ£€æŸ¥ Grade 6 ä¸Šå­¦æœŸæ¨¡å—çš„å…³é”®æ–‡ä»¶
python3 scripts/quick_audio_check.py stamps
python3 scripts/quick_audio_check.py festivals
python3 scripts/quick_audio_check.py habits

# æ£€æŸ¥ Grade 6 ä¸‹å­¦æœŸæ¨¡å—çš„å…³é”®æ–‡ä»¶
python3 scripts/quick_audio_check.py ordering-food
python3 scripts/quick_audio_check.py past-events
```

## æŠ¥å‘Šè§£è¯»

### è´¨é‡è¯„çº§æ ‡å‡†

- **é«˜è´¨é‡ (â‰¥90%)**: âœ… éŸ³é¢‘ä¸æ–‡æœ¬é«˜åº¦åŒ¹é…ï¼Œè´¨é‡ä¼˜ç§€
- **ä¸­ç­‰è´¨é‡ (70-89%)**: ğŸŸ¡ éŸ³é¢‘åŸºæœ¬æ­£ç¡®ï¼Œä½†æœ‰è½»å¾®å·®å¼‚
- **ä½è´¨é‡ (<70%)**: ğŸ”´ éŸ³é¢‘é—®é¢˜æ˜æ˜¾ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆ
- **æ–‡ä»¶ç¼ºå¤±**: âŒ éŸ³é¢‘æ–‡ä»¶ä¸å­˜åœ¨
- **è½¬å½•å¤±è´¥**: ğŸ’¥ Whisper æ— æ³•å¤„ç†éŸ³é¢‘æ–‡ä»¶

### å¸¸è§é—®é¢˜ç±»å‹

1. **è¯†åˆ«å‡†ç¡®ç‡æä½** (<50%)
   - éŸ³é¢‘æ–‡ä»¶å¯èƒ½æŸå
   - éŸ³é¢‘å†…å®¹ä¸æ–‡æœ¬ä¸åŒ¹é…
   - éŸ³é¢‘è´¨é‡å¤ªå·®

2. **éŸ³é¢‘å¯èƒ½è¢«æˆªæ–­**
   - è¯†åˆ«ç»“æœæ˜æ˜¾çŸ­äºåŸæ–‡
   - éŸ³é¢‘å¯èƒ½å½•åˆ¶ä¸å®Œæ•´

3. **éŸ³é¢‘å¯èƒ½åŒ…å«é¢å¤–å†…å®¹**
   - è¯†åˆ«ç»“æœæ˜æ˜¾é•¿äºåŸæ–‡
   - å¯èƒ½åŒ…å«å™ªéŸ³æˆ–é¢å¤–å½•éŸ³

## æ”¯æŒçš„æ¨¡å—

### Grade 6 ä¸Šå­¦æœŸæ¨¡å— (grade6-upper-mod)
- `stamps-hobbies` - é‚®ç¥¨å’Œçˆ±å¥½
- `festivals` - èŠ‚æ—¥
- `habits-tidy` - ä¹ æƒ¯å’Œæ•´æ´æˆ¿é—´

### Grade 6 ä¸‹å­¦æœŸæ¨¡å— (grade6-lower-mod)
- `01-ordering-food` - ç‚¹é¤
- `02-plans-and-weather` - è®¡åˆ’å’Œå¤©æ°”
- `03-past-events` - è¿‡å»çš„äº‹ä»¶
- `04-describing-actions` - æè¿°åŠ¨ä½œ
- `05-simultaneous-actions` - åŒæ—¶å‘ç”Ÿçš„åŠ¨ä½œ
- `06-gifts-and-past-actions` - ç¤¼ç‰©å’Œè¿‡å»çš„åŠ¨ä½œ
- `07-famous-people` - è‘—åäººç‰©
- `08-asking-why` - è¯¢é—®ä¸ºä»€ä¹ˆ
- `09-best-wishes` - æœ€å¥½çš„ç¥æ„¿
- `10-future-school-life` - æœªæ¥çš„å­¦æ ¡ç”Ÿæ´»

### å…¶ä»–æ¨¡å—
- æ”¯æŒæ‰€æœ‰ `module-*.json` æ ¼å¼çš„æ–‡ä»¶
- æ”¯æŒæ‰€æœ‰ `grade*-lower-mod-*.json` å’Œ `grade*-upper-mod-*.json` æ ¼å¼çš„æ–‡ä»¶

## å…¸å‹æ£€æŸ¥ç»“æœåˆ†æ

### ç¤ºä¾‹ï¼šStamps æ¨¡å—æ£€æŸ¥ç»“æœ

```
ğŸŸ¡ the-five-finger-mountain.mp3
   åŸæ–‡: The Five Finger Mountain
   è¯†åˆ«: The 5 finger mountain.
   ç›¸ä¼¼åº¦: 88.9%
```

**åˆ†æ**: éŸ³é¢‘è´¨é‡è‰¯å¥½ï¼Œä½†è¯†åˆ«ç»“æœå°†æ•°å­—å†™æˆäº†é˜¿æ‹‰ä¼¯æ•°å­—ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚

```
ğŸ”´ at-all.mp3
   åŸæ–‡: At All
   è¯†åˆ«: at home.
   ç›¸ä¼¼åº¦: 46.2%
```

**åˆ†æ**: éŸ³é¢‘è´¨é‡é—®é¢˜æ˜æ˜¾ï¼Œ"at all" è¢«è¯†åˆ«æˆ "at home"ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆã€‚

### ç¤ºä¾‹ï¼šHabits æ¨¡å—æ£€æŸ¥ç»“æœ

```
âœ… do-you-often-read-stories.mp3
   åŸæ–‡: Do You Often Read Stories
   è¯†åˆ«: Do you often read stories?
   ç›¸ä¼¼åº¦: 100.0%
```

**åˆ†æ**: å®Œç¾åŒ¹é…ï¼ŒéŸ³é¢‘è´¨é‡ä¼˜ç§€ã€‚

```
ğŸ”´ tidy.mp3
   åŸæ–‡: Tidy
   è¯†åˆ«: Tie the
   ç›¸ä¼¼åº¦: 36.4%
```

**åˆ†æ**: ä¸¥é‡é—®é¢˜ï¼Œ"tidy" è¢«è¯†åˆ«æˆ "tie the"ï¼Œéœ€è¦ç«‹å³é‡æ–°ç”Ÿæˆã€‚

## é—®é¢˜ä¿®å¤æµç¨‹

### 1. è¯†åˆ«é—®é¢˜æ–‡ä»¶
æ ¹æ®æ£€æŸ¥æŠ¥å‘Šï¼Œæ‰¾å‡ºæ‰€æœ‰ä½è´¨é‡å’Œç¼ºå¤±çš„éŸ³é¢‘æ–‡ä»¶ã€‚

### 2. é‡æ–°ç”ŸæˆéŸ³é¢‘
ä½¿ç”¨ `generate_missing_audio.py` é‡æ–°ç”Ÿæˆé—®é¢˜éŸ³é¢‘ï¼š

```bash
# ä¸ºå•ä¸ªæ–‡ä»¶é‡æ–°ç”ŸæˆéŸ³é¢‘
python3 -c "
import sys
sys.path.append('.')
from generate_missing_audio import CoquiAudioGenerator

generator = CoquiAudioGenerator()
generator.generate_coqui_tts('filename.mp3', 'Original Text')
"
```

### 3. éªŒè¯ä¿®å¤æ•ˆæœ
é‡æ–°è¿è¡Œæ£€æŸ¥è„šæœ¬ç¡®è®¤é—®é¢˜å·²è§£å†³ã€‚

### 4. æ‰¹é‡ä¿®å¤
å¯¹äºå¤§é‡é—®é¢˜æ–‡ä»¶ï¼Œå¯ä»¥ï¼š

1. åˆ›å»ºé—®é¢˜æ–‡ä»¶åˆ—è¡¨
2. ä½¿ç”¨è„šæœ¬æ‰¹é‡é‡æ–°ç”Ÿæˆ
3. å†æ¬¡è¿è¡Œè´¨é‡æ£€æŸ¥

## ä¾èµ–å®‰è£…

ç¡®ä¿å·²å®‰è£…å¿…è¦çš„ä¾èµ–ï¼š

```bash
pip install openai-whisper torch
```

## æœ€ä½³å®è·µ

### 1. å®šæœŸæ£€æŸ¥
- æ¯æ¬¡å¤§é‡éŸ³é¢‘æ›´æ–°åè¿è¡Œå®Œæ•´æ£€æŸ¥
- æ—¥å¸¸å¼€å‘ä½¿ç”¨å¿«é€Ÿæ£€æŸ¥è„šæœ¬
- ä¿æŒéŸ³é¢‘è´¨é‡åœ¨90%ä»¥ä¸Š

### 2. æ£€æŸ¥æ—¶æœº
- ğŸ”„ éŸ³é¢‘ç”Ÿæˆå®Œæˆå
- ğŸ”„ JSONé…ç½®æ–‡ä»¶ä¿®æ”¹å
- ğŸ”„ ä¸Šçº¿å‰è´¨é‡ä¿è¯
- ğŸ”„ ç”¨æˆ·åé¦ˆéŸ³é¢‘é—®é¢˜æ—¶

### 3. è´¨é‡æ ‡å‡†
- é«˜è´¨é‡éŸ³é¢‘åº”å 80%ä»¥ä¸Š
- ä½è´¨é‡éŸ³é¢‘åº”æ§åˆ¶åœ¨5%ä»¥å†…
- ç¼ºå¤±æ–‡ä»¶åº”ç«‹å³ä¿®å¤

## æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯

1. **ImportError: No module named 'whisper'**
   ```bash
   pip install openai-whisper torch
   ```

2. **CUDA out of memory**
   - ä½¿ç”¨æ›´å°çš„æ¨¡å‹ï¼š`whisper.load_model("tiny")`
   - å…³é—­GPUï¼šè®¾ç½® `fp16=False`

3. **éŸ³é¢‘æ–‡ä»¶æ— æ³•è½¬å½•**
   - æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   - æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸå

### æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨æ›´å°çš„ Whisper æ¨¡å‹ï¼ˆtiny/baseï¼‰æé«˜é€Ÿåº¦
- æ‰¹é‡æ£€æŸ¥æ—¶æ·»åŠ é€‚å½“å»¶è¿Ÿé¿å…è¿‡è½½
- ä½¿ç”¨ SSD å­˜å‚¨éŸ³é¢‘æ–‡ä»¶æé«˜è¯»å–é€Ÿåº¦

## æŠ¥å‘Šæ–‡ä»¶ä½ç½®

- å®Œæ•´æ£€æŸ¥æŠ¥å‘Šï¼š`audio_quality_report.txt`
- æ§åˆ¶å°è¾“å‡ºï¼šå®æ—¶æ˜¾ç¤ºæ£€æŸ¥ç»“æœ

## æŠ€æœ¯ç»†èŠ‚

### Whisper æ¨¡å‹é€‰æ‹©
- `tiny`: æœ€å¿«ï¼Œå‡†ç¡®åº¦è¾ƒä½
- `base`: å¹³è¡¡é€Ÿåº¦å’Œå‡†ç¡®åº¦ï¼ˆæ¨èï¼‰
- `small`: è¾ƒæ…¢ï¼Œå‡†ç¡®åº¦è¾ƒé«˜
- `medium`: æ…¢ï¼Œå‡†ç¡®åº¦é«˜
- `large`: æœ€æ…¢ï¼Œå‡†ç¡®åº¦æœ€é«˜

### ç›¸ä¼¼åº¦è®¡ç®—
ä½¿ç”¨ `difflib.SequenceMatcher` è®¡ç®—æ ‡å‡†åŒ–æ–‡æœ¬çš„ç›¸ä¼¼åº¦ï¼Œå»é™¤æ ‡ç‚¹ç¬¦å·å’Œå¤§å°å†™å½±å“ã€‚

---

é€šè¿‡è¿™äº›è„šæœ¬ï¼Œä½ å¯ä»¥æœ‰æ•ˆç›‘æ§å’Œä¿æŒéŸ³é¢‘ç³»ç»Ÿçš„è´¨é‡ï¼Œç¡®ä¿å­¦ç”Ÿè·å¾—æœ€ä½³çš„å­¦ä¹ ä½“éªŒã€‚
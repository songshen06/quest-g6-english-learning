# 🤖 自动化书籍导入脚本使用指南

## 📋 概述

自动化脚本 `import-book.cjs` 可以显著简化书籍导入流程，让维护人员只需要准备符合要求的JSON文件，脚本会自动处理后续的配置更新。

## 🚀 使用方法

### 运行脚本
```bash
npm run import-book
```

### 脚本功能
1. **自动扫描** `src/content/` 目录中的所有模块文件
2. **智能解析** 文件名并提取年级、学期、单元信息
3. **自动分组** 按书籍组织模块
4. **自动更新** 三个核心文件的配置：
   - `src/data/books.ts` - 书籍配置
   - `src/pages/BookModulesPage.tsx` - 模块导入
   - `src/pages/ModulePage.tsx` - 模块映射

## 📁 支持的文件命名格式

### 新格式（推荐）
```
grade6-upper-mod-01-school-life.json    // 六年级上册第1单元
grade5-lower-mod-03-food-drinks.json    // 五年级下册第3单元
```

### 兼容旧格式
```
module-01-how-long.json                 // 自动识别为六年级上册
grade6-lower-module-01-future-plans.json // 特殊格式，六年级下册
```

## 🔧 自动化处理

### 1. 文件命名规则
- 使用连字符分隔的标准化命名
- 包含年级、学期、单元号、主题信息
- 脚本自动转换为有效的JavaScript变量名

### 2. 书籍配置生成
脚本自动生成：
- 书籍基本信息（标题、副标题、描述等）
- 章节配置（自动编号和命名）
- 模块关联映射
- 难度等级和标签

### 3. 导入语句生成
- 自动生成TypeScript导入语句
- 处理文件名中的特殊字符
- 确保变量名符合JavaScript规范

### 4. 模块映射创建
- 完整的moduleId映射
- 简短ID映射（如 '01', '02'）
- 自动去重处理

## ✅ 验证清单

脚本运行完成后，请执行以下验证：

### 1. 构建测试
```bash
npm run build
```
确保没有编译错误。

### 2. 功能测试
```bash
npm run dev
```
启动开发服务器，测试：
- 书籍选择界面显示正常
- 所有书籍都可以点击选择
- 每本书的单元都能正确显示
- 单元内容能够正常加载

### 3. 内容验证
- 检查书籍数量是否正确
- 验证每个书籍的单元数量
- 确认单元标题和描述正确

## 📊 脚本输出示例

```
🚀 开始自动化书籍导入...

发现 12 个模块文件
发现的模块文件：
  - module-01-how-long.json (grade6-upper-mod-01)
  - grade6-lower-module-01-future-plans.json (grade6-lower-mod-01)
  ...

发现 2 本书籍：
  - 六年级上册 (10 个单元)
  - 六年级下册 (2 个单元)

更新 books.ts...
✓ books.ts 更新完成
更新 BookModulesPage.tsx...
✓ BookModulesPage.tsx 更新完成
更新 ModulePage.tsx...
✓ ModulePage.tsx 更新完成

✅ 自动化导入完成！

📋 下一步操作：
1. 运行 npm run build 检查是否有编译错误
2. 运行 npm run dev 启动开发服务器
3. 测试书籍选择和模块加载功能
```

## ⚠️ 注意事项

### 1. 文件命名要求
- 严格按照格式命名文件
- 使用小写字母和连字符
- 避免特殊字符和空格

### 2. JSON文件内容
- 确保JSON格式正确
- 必须包含required字段：moduleId, title, durationMinutes, words, phrases, quests
- moduleId必须与文件名中的ID一致

### 3. 脚本限制
- 目前只处理1-6年级
- 每本书最多10个单元
- 支持upper（上册）和lower（下册）学期

### 4. 冲突处理
- 脚本会覆盖现有配置
- 建议在运行前备份重要文件
- 如有自定义配置，需要在脚本运行后手动调整

## 🔄 维护工作流程

### 添加新书籍的完整流程：

1. **准备JSON文件**
   - 创建10个模块文件
   - 按命名规则保存到 `src/content/` 目录
   - 确保内容格式正确

2. **运行自动化脚本**
   ```bash
   npm run import-book
   ```

3. **验证结果**
   ```bash
   npm run build
   npm run dev
   ```

4. **功能测试**
   - 测试书籍选择
   - 验证单元加载
   - 检查练习功能

## 🎯 优势

- **效率提升**：从手动更新3个文件减少到运行1个命令
- **错误减少**：自动处理命名、导入、映射等易错环节
- **一致性保证**：确保所有配置格式统一
- **维护简单**：只需要关注JSON文件内容

## 🔍 故障排除

### 常见问题：

1. **"未发现任何模块文件"**
   - 检查文件命名格式
   - 确认文件在正确的目录中
   - 验证文件扩展名为.json

2. **构建错误**
   - 检查JSON文件格式是否正确
   - 验证required字段是否完整
   - 确认moduleId与文件名匹配

3. **模块加载失败**
   - 检查模块映射是否正确生成
   - 验证导入语句的变量名
   - 确认文件路径正确

---

通过这个自动化脚本，维护书籍内容的工作量大大减少，只需要专注于创建高质量的JSON模块文件即可！